import * as ___react___ from 'react';
import * as ___react_dom___ from 'react-dom'; 

function require(mod) {
  if (mod === 'react') return ___react___;
  if (mod === 'react-dom') return ___react_dom___;
  throw new Error(`Unknown module ${mod}`);
}
import{b as s}from"../../chunk-SXTJF4PD.js";import{a as p,b as P}from"../../chunk-M7E5UEO3.js";import"../../chunk-A6CVKSUD.js";import{e as v}from"../../chunk-GDQBQ7MK.js";v();function g(o){return{execute:async(e,t)=>{let{abortSignal:n}=t||{};if(!n)try{return[null,await o.unsafe(e.sql,e.parameters)]}catch(a){return[a]}if(n.aborted)return s();let i,r;try{let a,c=new Promise(q=>a=q);n.addEventListener("abort",i=()=>a());let u=o.reserve(),l=await Promise.race([u,c]);if(!l)return u.catch(()=>{}),s();if(r=l,n.aborted)return r.release(),s();let d=w(r),f=await Promise.race([d,c]);if(f===void 0)return d.catch(()=>{}).finally(()=>r?.release()),s();if(n.aborted)return r.release(),s();let m=r.unsafe(e.sql,e.parameters),y=await Promise.race([m,c]);return y?(r.release(),[null,y]):(Promise.allSettled([b(o,f),m]).finally(()=>r?.release()),s())}catch(a){return r?.release(),[a]}finally{i&&n?.removeEventListener("abort",i)}}}}async function b(o,e){let t=P(e);try{await o.unsafe(t.sql,t.parameters)}catch(n){console.error("Failed to cancel query:",n)}}async function w(o){let e=p();try{let[t]=await o.unsafe(e.sql,e.parameters);return t?.pid}catch(t){console.error("Failed to get connection PID:",t);return}}export{g as createPostgresJSExecutor};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vZGF0YS9wb3N0Z3Jlc2pzL2luZGV4LnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgdHlwZSB7IFJlc2VydmVkU3FsLCBTcWwgfSBmcm9tIFwicG9zdGdyZXNcIjtcblxuaW1wb3J0IHsgdHlwZSBFeGVjdXRvciwgZ2V0QWJvcnRSZXN1bHQgfSBmcm9tIFwiLi4vZXhlY3V0b3JcIjtcbmltcG9ydCB7IGdldENhbmNlbFF1ZXJ5LCBnZXRQSURRdWVyeSB9IGZyb20gXCIuLi9wb3N0Z3Jlcy1jb3JlL3V0aWxpdHlcIjtcbmltcG9ydCB0eXBlIHsgUXVlcnlSZXN1bHQgfSBmcm9tIFwiLi4vcXVlcnlcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVBvc3RncmVzSlNFeGVjdXRvcihwb3N0Z3Jlc2pzOiBTcWwpOiBFeGVjdXRvciB7XG4gIHJldHVybiB7XG4gICAgZXhlY3V0ZTogYXN5bmMgKHF1ZXJ5LCBvcHRpb25zKSA9PiB7XG4gICAgICBjb25zdCB7IGFib3J0U2lnbmFsIH0gPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgICBpZiAoIWFib3J0U2lnbmFsKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9zdGdyZXNqcy51bnNhZmUocXVlcnkuc3FsLCBxdWVyeS5wYXJhbWV0ZXJzIGFzIG5ldmVyKTtcblxuICAgICAgICAgIHJldHVybiBbbnVsbCwgcmVzdWx0IGFzIG5ldmVyXTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICAgICAgICByZXR1cm4gW2Vycm9yIGFzIEVycm9yXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoYWJvcnRTaWduYWwuYWJvcnRlZCkge1xuICAgICAgICByZXR1cm4gZ2V0QWJvcnRSZXN1bHQoKTtcbiAgICAgIH1cblxuICAgICAgbGV0IGFib3J0TGlzdGVuZXI6ICgoKSA9PiB2b2lkKSB8IHVuZGVmaW5lZDtcbiAgICAgIGxldCBjb25uZWN0aW9uOiBSZXNlcnZlZFNxbCB8IHVuZGVmaW5lZDtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgbGV0IGFib3J0ZWQ6ICgpID0+IHZvaWQ7XG4gICAgICAgIGNvbnN0IGFib3J0aW9uUHJvbWlzZSA9IG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlKSA9PiAoYWJvcnRlZCA9IHJlc29sdmUpKTtcblxuICAgICAgICBhYm9ydFNpZ25hbC5hZGRFdmVudExpc3RlbmVyKFwiYWJvcnRcIiwgKGFib3J0TGlzdGVuZXIgPSAoKSA9PiBhYm9ydGVkKCkpKTtcblxuICAgICAgICBjb25zdCBjb25uZWN0aW9uUHJvbWlzZSA9IHBvc3RncmVzanMucmVzZXJ2ZSgpO1xuXG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb25SZXN1bHQgPSBhd2FpdCBQcm9taXNlLnJhY2UoW2Nvbm5lY3Rpb25Qcm9taXNlLCBhYm9ydGlvblByb21pc2VdKTtcblxuICAgICAgICBpZiAoIWNvbm5lY3Rpb25SZXN1bHQpIHtcbiAgICAgICAgICB2b2lkIGNvbm5lY3Rpb25Qcm9taXNlLmNhdGNoKCgpID0+IHt9KTtcblxuICAgICAgICAgIHJldHVybiBnZXRBYm9ydFJlc3VsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29ubmVjdGlvbiA9IGNvbm5lY3Rpb25SZXN1bHQ7XG5cbiAgICAgICAgaWYgKGFib3J0U2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgICAgICBjb25uZWN0aW9uLnJlbGVhc2UoKTtcblxuICAgICAgICAgIHJldHVybiBnZXRBYm9ydFJlc3VsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcGlkUHJvbWlzZSA9IGdldENvbm5lY3Rpb25QSUQoY29ubmVjdGlvbik7XG5cbiAgICAgICAgY29uc3QgcGlkUmVzdWx0ID0gYXdhaXQgUHJvbWlzZS5yYWNlKFtwaWRQcm9taXNlLCBhYm9ydGlvblByb21pc2VdKTtcblxuICAgICAgICBpZiAocGlkUmVzdWx0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB2b2lkIHBpZFByb21pc2UuY2F0Y2goKCkgPT4ge30pLmZpbmFsbHkoKCkgPT4gY29ubmVjdGlvbj8ucmVsZWFzZSgpKTtcblxuICAgICAgICAgIHJldHVybiBnZXRBYm9ydFJlc3VsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFib3J0U2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgICAgICBjb25uZWN0aW9uLnJlbGVhc2UoKTtcblxuICAgICAgICAgIHJldHVybiBnZXRBYm9ydFJlc3VsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcXVlcnlQcm9taXNlID0gY29ubmVjdGlvbi51bnNhZmUocXVlcnkuc3FsLCBxdWVyeS5wYXJhbWV0ZXJzIGFzIG5ldmVyKTtcblxuICAgICAgICBjb25zdCBxdWVyeVJlc3VsdCA9IGF3YWl0IFByb21pc2UucmFjZShbcXVlcnlQcm9taXNlLCBhYm9ydGlvblByb21pc2VdKTtcblxuICAgICAgICBpZiAoIXF1ZXJ5UmVzdWx0KSB7XG4gICAgICAgICAgdm9pZCBQcm9taXNlLmFsbFNldHRsZWQoW2NhbmNlbFF1ZXJ5KHBvc3RncmVzanMsIHBpZFJlc3VsdCEpLCBxdWVyeVByb21pc2VdKS5maW5hbGx5KCgpID0+XG4gICAgICAgICAgICBjb25uZWN0aW9uPy5yZWxlYXNlKCksXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHJldHVybiBnZXRBYm9ydFJlc3VsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29ubmVjdGlvbi5yZWxlYXNlKCk7XG5cbiAgICAgICAgcmV0dXJuIFtudWxsLCBxdWVyeVJlc3VsdCBhcyBuZXZlcl07XG4gICAgICB9IGNhdGNoIChlcnJvcjogdW5rbm93bikge1xuICAgICAgICBjb25uZWN0aW9uPy5yZWxlYXNlKCk7XG5cbiAgICAgICAgcmV0dXJuIFtlcnJvciBhcyBFcnJvcl07XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBpZiAoYWJvcnRMaXN0ZW5lcikge1xuICAgICAgICAgIGFib3J0U2lnbmFsPy5yZW1vdmVFdmVudExpc3RlbmVyKFwiYWJvcnRcIiwgYWJvcnRMaXN0ZW5lcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICB9O1xufVxuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWVtcHR5LW9iamVjdC10eXBlXG5hc3luYyBmdW5jdGlvbiBjYW5jZWxRdWVyeShwb3N0Z3Jlc2pzOiBTcWwsIHBpZDoge30pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgcXVlcnkgPSBnZXRDYW5jZWxRdWVyeShwaWQpO1xuXG4gIHRyeSB7XG4gICAgYXdhaXQgcG9zdGdyZXNqcy51bnNhZmUocXVlcnkuc3FsLCBxdWVyeS5wYXJhbWV0ZXJzIGFzIG5ldmVyKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNhbmNlbCBxdWVyeTpcIiwgZXJyb3IpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldENvbm5lY3Rpb25QSUQoY29ubmVjdGlvbjogUmVzZXJ2ZWRTcWwpOiBQcm9taXNlPHVua25vd24+IHtcbiAgY29uc3QgcXVlcnkgPSBnZXRQSURRdWVyeSgpO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgW3Jlc3VsdF0gPSBhd2FpdCBjb25uZWN0aW9uLnVuc2FmZTxRdWVyeVJlc3VsdDx0eXBlb2YgcXVlcnk+PihxdWVyeS5zcWwsIHF1ZXJ5LnBhcmFtZXRlcnMgYXMgbmV2ZXIpO1xuXG4gICAgcmV0dXJuIHJlc3VsdD8ucGlkO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IGNvbm5lY3Rpb24gUElEOlwiLCBlcnJvcik7XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7OzsyS0FBQUEsSUFNTyxTQUFTQyxFQUF5QkMsRUFBMkIsQ0FDbEUsTUFBTyxDQUNMLFFBQVMsTUFBT0MsRUFBT0MsSUFBWSxDQUNqQyxHQUFNLENBQUUsWUFBQUMsQ0FBWSxFQUFJRCxHQUFXLENBQUMsRUFFcEMsR0FBSSxDQUFDQyxFQUNILEdBQUksQ0FHRixNQUFPLENBQUMsS0FGTyxNQUFNSCxFQUFXLE9BQU9DLEVBQU0sSUFBS0EsRUFBTSxVQUFtQixDQUU5QyxDQUMvQixPQUFTRyxFQUFnQixDQUN2QixNQUFPLENBQUNBLENBQWMsQ0FDeEIsQ0FHRixHQUFJRCxFQUFZLFFBQ2QsT0FBT0UsRUFBZSxFQUd4QixJQUFJQyxFQUNBQyxFQUVKLEdBQUksQ0FDRixJQUFJQyxFQUNFQyxFQUFrQixJQUFJLFFBQWVDLEdBQWFGLEVBQVVFLENBQVEsRUFFMUVQLEVBQVksaUJBQWlCLFFBQVVHLEVBQWdCLElBQU1FLEVBQVEsQ0FBRSxFQUV2RSxJQUFNRyxFQUFvQlgsRUFBVyxRQUFRLEVBRXZDWSxFQUFtQixNQUFNLFFBQVEsS0FBSyxDQUFDRCxFQUFtQkYsQ0FBZSxDQUFDLEVBRWhGLEdBQUksQ0FBQ0csRUFDSCxPQUFLRCxFQUFrQixNQUFNLElBQU0sQ0FBQyxDQUFDLEVBRTlCTixFQUFlLEVBS3hCLEdBRkFFLEVBQWFLLEVBRVRULEVBQVksUUFDZCxPQUFBSSxFQUFXLFFBQVEsRUFFWkYsRUFBZSxFQUd4QixJQUFNUSxFQUFhQyxFQUFpQlAsQ0FBVSxFQUV4Q1EsRUFBWSxNQUFNLFFBQVEsS0FBSyxDQUFDRixFQUFZSixDQUFlLENBQUMsRUFFbEUsR0FBSU0sSUFBYyxPQUNoQixPQUFLRixFQUFXLE1BQU0sSUFBTSxDQUFDLENBQUMsRUFBRSxRQUFRLElBQU1OLEdBQVksUUFBUSxDQUFDLEVBRTVERixFQUFlLEVBR3hCLEdBQUlGLEVBQVksUUFDZCxPQUFBSSxFQUFXLFFBQVEsRUFFWkYsRUFBZSxFQUd4QixJQUFNVyxFQUFlVCxFQUFXLE9BQU9OLEVBQU0sSUFBS0EsRUFBTSxVQUFtQixFQUVyRWdCLEVBQWMsTUFBTSxRQUFRLEtBQUssQ0FBQ0QsRUFBY1AsQ0FBZSxDQUFDLEVBRXRFLE9BQUtRLEdBUUxWLEVBQVcsUUFBUSxFQUVaLENBQUMsS0FBTVUsQ0FBb0IsSUFUM0IsUUFBUSxXQUFXLENBQUNDLEVBQVlsQixFQUFZZSxDQUFVLEVBQUdDLENBQVksQ0FBQyxFQUFFLFFBQVEsSUFDbkZULEdBQVksUUFBUSxDQUN0QixFQUVPRixFQUFlLEVBTTFCLE9BQVNELEVBQWdCLENBQ3ZCLE9BQUFHLEdBQVksUUFBUSxFQUViLENBQUNILENBQWMsQ0FDeEIsUUFBRSxDQUNJRSxHQUNGSCxHQUFhLG9CQUFvQixRQUFTRyxDQUFhLENBRTNELENBQ0YsQ0FDRixDQUNGLENBR0EsZUFBZVksRUFBWWxCLEVBQWlCbUIsRUFBd0IsQ0FDbEUsSUFBTWxCLEVBQVFtQixFQUFlRCxDQUFHLEVBRWhDLEdBQUksQ0FDRixNQUFNbkIsRUFBVyxPQUFPQyxFQUFNLElBQUtBLEVBQU0sVUFBbUIsQ0FDOUQsT0FBU0csRUFBTyxDQUNkLFFBQVEsTUFBTSwwQkFBMkJBLENBQUssQ0FDaEQsQ0FDRixDQUVBLGVBQWVVLEVBQWlCUCxFQUEyQyxDQUN6RSxJQUFNTixFQUFRb0IsRUFBWSxFQUUxQixHQUFJLENBQ0YsR0FBTSxDQUFDQyxDQUFNLEVBQUksTUFBTWYsRUFBVyxPQUFrQ04sRUFBTSxJQUFLQSxFQUFNLFVBQW1CLEVBRXhHLE9BQU9xQixHQUFRLEdBQ2pCLE9BQVNsQixFQUFPLENBQ2QsUUFBUSxNQUFNLGdDQUFpQ0EsQ0FBSyxFQUVwRCxNQUNGLENBQ0YiLAogICJuYW1lcyI6IFsiaW5pdF9kZWZpbmVfQUNDRUxFUkFURV9TQ0hFTUFfQllfUFJPVklERVIiLCAiY3JlYXRlUG9zdGdyZXNKU0V4ZWN1dG9yIiwgInBvc3RncmVzanMiLCAicXVlcnkiLCAib3B0aW9ucyIsICJhYm9ydFNpZ25hbCIsICJlcnJvciIsICJnZXRBYm9ydFJlc3VsdCIsICJhYm9ydExpc3RlbmVyIiwgImNvbm5lY3Rpb24iLCAiYWJvcnRlZCIsICJhYm9ydGlvblByb21pc2UiLCAicmVzb2x2ZSIsICJjb25uZWN0aW9uUHJvbWlzZSIsICJjb25uZWN0aW9uUmVzdWx0IiwgInBpZFByb21pc2UiLCAiZ2V0Q29ubmVjdGlvblBJRCIsICJwaWRSZXN1bHQiLCAicXVlcnlQcm9taXNlIiwgInF1ZXJ5UmVzdWx0IiwgImNhbmNlbFF1ZXJ5IiwgInBpZCIsICJnZXRDYW5jZWxRdWVyeSIsICJnZXRQSURRdWVyeSIsICJyZXN1bHQiXQp9Cg==